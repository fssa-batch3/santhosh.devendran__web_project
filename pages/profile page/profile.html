<!DOCTYPE html>
<html lang="en">

    <head>
        <link rel="stylesheet" href="../../assets/css/font style.css">
        <title>profile</title>
        <link rel="stylesheet" href="../../assets/css/profile css/profile.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>

    <body>
        <!-- header -->
        <main>

            <section class="left_side">
                <div class="center">

                    <div class="profile_top">
                        <div class="back_button">
                            <a href="../home.html">
                                <i class="fa fa-arrow-left" style="font-size:24px"></i>
                            </a>
                        </div>
                        <div class="user">
                            <span>
                                <b id="tname"></b>
                            </span>
                            <p class="post_count"> 124 posts</p>
                        </div>
                        <div class="d_bn">
                            <button class="delete_bn" id="delete_bn">delete</button>
                            <button class="logout_bn" id="logout_bn">log out</button>
                        </div>
                    </div>

                    <div class="profile_photo">
                        <div class="cover_img">
                            <img alt="cover photo" id="cover_img" src="" width="100%" height="250px">
                        </div>

                        <!-- ../../assets/img/user/cover img/profile back cover.jpg
                            ../../assets/img/user/DS profile img.jpg -->
                        <div class="dp">
                            <img alt="profile image" id="profile_image" src="" width="130px" height="130px">
                        </div>
                    </div>
                    <div class="user_details">

                        <h2 class="username" id="name"></h2>
                        <p class="unicname" id="user_name"></p>
                        <h3 class="bio">Bio</h3>
                        <div class="about_user">
                            <p id="bio"></p>
                        </div>
                        <div class="birth">
                            <p id="dob">Born</p>
                        </div>
                    </div>

                    <div class="follower_count">
                        <span id="follower_count">
                            <b id="fr_count">08</b>
                            <p >followers</p>
                        </span>
                        <span id="following_count">
                            <b id="fg_count">04</b>
                            <p >following</p>
                        </span>
                    </div>
                    <div class="bn">
                        <a id="edit_bn_page">
                            <button class="edit edit_bn">edit</button>
                        </a>
                        <button id="follow_bn" class="edit follow_bn">follow</button>

                    </div>

                </div>

                <div class="postandlikes">
                    <a href="./profile.html">
                        <h2 class="hilight">posts</h2>
                    </a>
                    <a href="./profile - liked.html">
                        <h2 class="likes">likes</h2>
                    </a>
                </div>


            </section>

            <section class="right_side">

                <div class="right_top">

                    <h2 class="heading">Trending</h2>
                    <div class="top">
                        <div class="hash">
                            <div class="hex">
                                <span class="hex_code">#</span>
                            </div>
                            <div class="topic_list">
                                <p class="topic">Election in india</p>

                            </div>
                        </div>
                        <div class="interest">
                            <a href="">
                                <img alt="img" src="../../assets/img/thumps up.png" class="intrest img" width="30px"
                                    height="30px"></a>
                        </div>
                    </div>

                    <div class="top">
                        <div class="hash">
                            <div class="hex">
                                <span class="hex_code">#</span>
                            </div>
                            <div class="topic_list">
                                <p class="topic">russia ukrain war</p>

                            </div>
                        </div>
                        <div class="interest">
                            <a href="">
                                <img alt="img" src="../../assets/img/thumps up.png" class="intrest img" width="30px"
                                    height="30px"></a>
                        </div>
                    </div>

                </div>
                <div class="right_bottom">
                    <h2 class="heading right_bottom">Who to follow</h2>
    

                </div>

            </section>

        </main>
        <a href="../profile page/edit profile.html"></a>

        <script src="../../assets/js/header.js"></script>

        <script>
        
        const unic_user_id = JSON.parse(localStorage.getItem("user_id"));
  if (unic_user_id == "") {
    window.location.href = "../../index.html";
  }

const params = new URLSearchParams(window.location.search);
  const user_Id = params.get("user_id");

const edit_bn = document.getElementsByClassName("edit_bn");
  const follow_bn = document.getElementsByClassName("follow_bn");

  if (unic_user_id !== user_Id) {
    edit_bn[0].style.display = "none";
    follow_bn[0].style.display = "block";
  }
  //  for other user profile/////////////
  if (user_Id !== unic_user_id) {
    const user_records = JSON.parse(localStorage.getItem("user_list"));

    function login_data(e) {
      return e.user_name == user_Id;
    }
    const user_data = user_records.find(login_data);

    // for profile image

    const imgPreview = document.getElementById("profile_image");
    const cover_imgPreview = document.getElementById("cover_img");

    if (user_data.user_dp == "") {
      imgPreview.src = "../../assets/img/user/cover img/profile back cover.jpg";
    } else {
      imgPreview.src = user_data.user_dp;
    }

    if (user_data.user_cover_img == "") {
      cover_imgPreview.src = "../../assets/img/user/DS profile img.jpg";
    } else {
      cover_imgPreview.src = user_data.user_cover_img;
    }

    const name = `${user_data.first_name} ${user_data.last_name}`;

    document.getElementById("tname").innerHTML = name;
    document.getElementById("name").innerHTML = name;
    document.getElementById("user_name").innerHTML = user_data.user_name;
    document.getElementById("bio").innerHTML = user_data.user_bio;
    document.getElementById("dob").innerHTML = `Born in ${user_data.dob}`;

    const logout = document.getElementsByClassName("logout_bn");
    if (logout.length > 0) {
      logout[0].style.display = "none";
    }
    const delete_bn = document.getElementsByClassName("delete_bn");
    if (delete_bn.length > 0) {
      delete_bn[0].style.display = "none";
    }
  }
  //  for login user///////////

  if (user_Id == unic_user_id) {
    const user_records = JSON.parse(localStorage.getItem("user_list"));

    function login_data(e) {
      return e.user_name == unic_user_id;
    }
    const user_data = user_records.find(login_data);

    // for profile image

    const imgPreview = document.getElementById("profile_image");
    const cover_imgPreview = document.getElementById("cover_img");

    if (user_data.user_dp == "") {
      imgPreview.src = "../../assets/img/user/cover img/profile back cover.jpg";
    } else {
      imgPreview.src = user_data.user_dp;
    }

    if (user_data.user_cover_img == "") {
      cover_imgPreview.src = "../../assets/img/user/DS profile img.jpg";
    } else {
      cover_imgPreview.src = user_data.user_cover_img;
    }

    const name = `${user_data.first_name} ${user_data.last_name}`;

  document.getElementById("tname").innerHTML = name;
    document.getElementById("name").innerHTML = name;
    document.getElementById("user_name").innerHTML = user_data.user_name;
    document.getElementById("bio").innerHTML = user_data.user_bio;
    document.getElementById("dob").innerHTML = `Born in ${user_data.dob}`;

    if (follow_bn.length > 0) {
      follow_bn[0].style.display = "none";
    }
    if (edit_bn.length > 0) {
      edit_bn[0].style.display = "block";
    }
  }

  // for follow unfollow button show  //

  const follow_bn_function = document.getElementById("follow_bn");
  const follow_data = JSON.parse(localStorage.getItem("follow_data"));
  const user_f_data = follow_data.find(
  (e) => e.followee == unic_user_id && e.following == user_Id
);

  if (user_f_data == undefined) {
    follow_bn_function.innerText = "follow";
  } else {
    follow_bn_function.innerText = "Unfollow";
  }

// for follow and Unfollow button feature  ////

  follow_bn_function.addEventListener("click", function () {
    const following = user_Id;
    const followee = unic_user_id;

    const follow_bn = document.getElementById(following);
    const follow_data = JSON.parse(localStorage.getItem("follow_data")) || [];
    if (follow_data.length === 0) {
      follow_data.push({
        following,
        followee,
        notification: false,
      });
      console.log(follow_data);
      follow_bn_function.innerHTML = "Unfollow";
      localStorage.setItem("follow_data", JSON.stringify(follow_data));
    } else {
      const user_f_data = follow_data.find(
        (e) => e.followee == unic_user_id && e.following == following
      );
      const indexOfuser_f = follow_data.indexOf(user_f_data);
      if (user_f_data == undefined) {
        follow_data.push({
          following,
          followee,
          notification: false,
        });
        follow_bn_function.innerText = "Unfollow";
        localStorage.setItem("follow_data", JSON.stringify(follow_data));
      } else {
        follow_data.splice(indexOfuser_f, 1);
        localStorage.setItem("follow_data", JSON.stringify(follow_data));
        follow_bn_function.innerText = "follow";
      }
    }
  });

//  user edit page
  const edit_button = document.getElementById("edit_bn_page");
 
  edit_button.setAttribute(
  "href",
    `../profile page/edit profile.html?user_id=${unic_user_id}`
);

// function for delete

const delete_bn=document.getElementById("delete_bn");

delete_bn.addEventListener("click",
  function deletData(e) {
    const password_for_delete = prompt("Please enter your password:");
    let check = false;
    const user_records = JSON.parse(localStorage.getItem("user_list"));
    function login_data(e) {
      return e.user_name == unic_user_id;
    }
    const user_data = user_records.find(login_data);
    if (password_for_delete == user_data.password) {
      check = true;
    } else {
      alert("password is incorect");
    }

    if (check === true) {
      const unic_user_id = JSON.parse(localStorage.getItem("user_id"));
      const user_records = JSON.parse(localStorage.getItem("user_list"));
      function login_data(e) {
        return e.user_name == unic_user_id;
      }
      const user_data = user_records.find(login_data);

      const indexOfUser = user_records.indexOf(user_data);
      user_records.splice(indexOfUser, 1);
      localStorage.setItem("user_list", JSON.stringify(user_records));
      const user_id = "";
      localStorage.setItem("user_id", JSON.stringify(user_id));
      window.location.href = "../../index.html";
  }
  }
  )

  // function for log out

  const logout_bn=document.getElementById("logout_bn");

  logout_bn.addEventListener("click",

  function logout(e) {
    if (confirm("Are you sure")) {
      const user_id = "";
      localStorage.setItem("user_id", JSON.stringify(user_id));
      window.location.href = "../../index.html";
    }
  }
  )

const post_feedd = JSON.parse(localStorage.getItem("post_feedd"));

  //    filter data///////

  const filterpost = post_feedd.filter((post) => post.unic_id == user_Id);
 
  for (const element of filterpost) {
  //  <div class="post"> </div>
   let div_post = document.createElement("div");

    div_post.setAttribute("class", "post");

    //  <div class="user_list"> </div>
   let div_user_list = document.createElement("div");
    div_user_list.setAttribute("class", "user_list");
    div_post.append(div_user_list);

    //  <div class="img"> </div>
   let div_img = document.createElement("div");
    div_img.setAttribute("class", "img");
    div_user_list.append(div_img);

    //<a href="./details.html"></a>
    // a_img = document.createElement("a");
    // a_img.setAttribute("href", "./profile page/user profile/elon musk.html");
    // div_img.append(a_img);

  //  <img user profile/>
  let  img_a = document.createElement("img");
    img_a.setAttribute("src", element.user_profile.img);
    img_a.setAttribute("alt", "profile");
    img_a.setAttribute("class", "profile_img");
    div_img.append(img_a);

  //  <div class="user"> </div>
   let div_user = document.createElement("div");
    div_user.setAttribute("class", "user");
    div_user_list.append(div_user);

    // //<a href="./details.html"></a>
    // a_user = document.createElement("a");
    // a_user.setAttribute("href", "./profile page/user profile/elon musk.html");
    // div_user.append(a_user);

    //  <p> user name</p>
   let p_user_name = document.createElement("p");
    p_user_name.setAttribute("class", "user_name");
    p_user_name.innerText = element.user_name;
    div_user.append(p_user_name);

  //  span for delete button
   let span_delete = document.createElement("span");
    span_delete.setAttribute("class", "delete");
    div_user.append(span_delete);

    // button for delete
    const delete_bn = document.createElement("button");
    delete_bn.setAttribute("class", "deletebn");
    delete_bn.innerText = "delete";
    delete_bn.setAttribute("id", element.delete_bn + element.unic_id);
    span_delete.append(delete_bn);

    delete_bn.addEventListener("click", function () {
      if (confirm("Are you sure to Delete ?")) {
        const post_id = JSON.parse(localStorage.getItem("post_id"));
        const post_feedd = JSON.parse(localStorage.getItem("post_feedd"));
        function find_post(e) {
          console.log(post_id);
          return (
            e.post_id + e.unic_id ==
            element.delete_bn + element.unic_id
          );
        }
      let  user_data = post_feedd.find(find_post);
        const indexOfUser = post_feedd.indexOf(user_data);
        post_feedd.splice(indexOfUser, 1);
        localStorage.setItem("post_feedd", JSON.stringify(post_feedd));
      }

      location.reload();
      
    });

  //  <p> post cuntent</p>
  let  p_post_cuntent = document.createElement("p");
    p_post_cuntent.setAttribute("class", "post_cuntent");
    p_post_cuntent.innerText = element.post_content;
    div_user.append(p_post_cuntent);

    if (element.post_img.src) {
      //  <div class="post_img"> </div>
  let    post_post_img = document.createElement("div");
      post_post_img.setAttribute("class", "post_img");
      div_post.append(post_post_img);

      //  <img user post/>
  let    img_post = document.createElement("img");
      img_post.setAttribute("src", element.post_img.src);
      img_post.setAttribute("alt", "post");
      post_post_img.append(img_post);
  }

  //  <div class="like_comand"> </div>
  let  div_like_comand = document.createElement("div");
    div_like_comand.setAttribute("class", "like_comand");
    div_post.append(div_like_comand);

    //  <div class="like"> </div>
  let  div_like = document.createElement("div");
    div_like.setAttribute("class", "like");
    div_like_comand.append(div_like);

  // <i for like
  let  i_like = document.createElement("i");
    i_like.setAttribute("class", "fa fa-heart-o");
    i_like.setAttribute("id", element.post_id);
    i_like.innerText = element.like;
    const like_data = JSON.parse(localStorage.getItem("like_data")) || [];
    const like_icon = like_data.find(
  (e) => e.liked == element.post_id && e.who_liked == unic_user_id
  );
  if (like_icon == undefined) {
      i_like.setAttribute("class", "fa fa-heart-o");
      i_like.setAttribute("style", "font-size:16px;color: black;");
    } else {
      i_like.setAttribute("class", "fa fa-heart");
      i_like.setAttribute("style", "font-size:16px;color: red;");
    }

    div_like.append(i_like);
  
    i_like.addEventListener("click", function () {
      const liked = this.id;
      const who_liked = unic_user_id;

      const like_bn = document.getElementById(liked);
      const like_data = JSON.parse(localStorage.getItem("like_data")) || [];
      if (like_data.length === 0) {
        like_data.push({
          liked,
          who_liked,
          notification: false,
        });
        console.log(like_data);
        like_bn.setAttribute("class", "fa fa-heart");
        like_bn.setAttribute("style", "font-size:16px;color: red;");
        localStorage.setItem("like_data", JSON.stringify(like_data));
        // instend add like count
        const find_post = post_feedd.find((e) => e.post_id === liked);
        const new_count = find_post.like + 1;
        like_bn.innerText = new_count;
      } else {
        const user_l_data = like_data.find(
          (e) => e.liked == liked && e.who_liked == unic_user_id
        );
      const indexOfuser_f = like_data.indexOf(user_l_data);
        if (user_l_data == undefined) {
          like_data.push({
            liked,
            who_liked,
            notification: false,
          });
          like_bn.setAttribute("class", "fa fa-heart");
          like_bn.setAttribute("style", "font-size:16px;color: red;");
          localStorage.setItem("like_data", JSON.stringify(like_data));
          // instend add like count
          const find_post = post_feedd.find((e) => e.post_id === liked);
          const new_count = find_post.like + 1;
          like_bn.innerText = new_count;
        } else {
          like_data.splice(indexOfuser_f, 1);
          localStorage.setItem("like_data", JSON.stringify(like_data));
          like_bn.setAttribute("class", "fa fa-heart-o");
          like_bn.setAttribute("style", "font-size:16px;color: Black;");
          // instend add like count
          const find_post = post_feedd.find((e) => e.post_id === liked);
          if (find_post.like >= 1) {
            const new_count = find_post.like - 1;
            like_bn.innerText = new_count;
          }
        }
      }

      //  for like count set
      //  add comand count in post details

      const filterlike = like_data.filter((like) => like.liked == liked);

      const find_post = post_feedd.find((e) => e.post_id === liked);
      find_post.like = filterlike.length;

      localStorage.setItem("post_feedd", JSON.stringify(post_feedd));
    });


    //  a tag for  comment///////
  let  a_div_cmt = document.createElement("a");
    a_div_cmt.setAttribute(
      "href",
      `../post details/elon musk/comment - post1.html?post_id=${element.post_id}`
    );
  div_like_comand.append(a_div_cmt);

    //  <div class="comand"> </div>
  let  div_comand = document.createElement("div");
    div_comand.setAttribute("class", "comand");
    a_div_cmt.append(div_comand);

    // <i for comand
  let  i_comand = document.createElement("i");
    i_comand.setAttribute("class", "fa fa-comment-o");
    i_comand.innerText = element.comand;
    i_comand.setAttribute("style", "font-size:18px;color: black;");
    div_comand.append(i_comand);


    document.querySelector(".left_side").append(div_post);
  }

//  top user showing ///////
  const top_user_2 = JSON.parse(localStorage.getItem("user_list"));
  const top_user = top_user_2.filter((e) => e.user_name !== unic_user_id);

  user_profile = "../assets/img/user/DS profile img.jpg";

  for (const element of top_user) {
    const user_name = `${element.first_name} ${element.last_name}`;

  //  <div class="top_user"> </div>
  let  div_top_user = document.createElement("div");
    div_top_user.setAttribute("class", "top_user");

    //  <div class="img"> </div>
  let  div_img = document.createElement("div");
    div_img.setAttribute("class", "img");
    div_top_user.append(div_img);

    //  <img profile_img/>
  let  img_profile_img = document.createElement("img");
    img_profile_img.setAttribute("src", user_profile);
    img_profile_img.setAttribute("alt", "profile");
    img_profile_img.setAttribute("class", "profile_img");
    div_img.append(img_profile_img);

    //  <div class="user_list"> </div>
  let  div_user_list = document.createElement("div");
    div_user_list.setAttribute("class", "user_list");
    div_top_user.append(div_user_list);

    // <p tag for user name
  let  p_user_name = document.createElement("p");
    p_user_name.setAttribute("class", "user_name");
    p_user_name.innerText = user_name;
    div_user_list.append(p_user_name);

    //<span> tag for gray
  let  span_gray = document.createElement("span");
    span_gray.setAttribute("class", "gray");
    span_gray.innerText = element.user_name;
    div_user_list.append(span_gray);

    //div_follow_button /////

  let  div_follow_button = document.createElement("div");
    div_follow_button.setAttribute("class", "follow_button");
    div_top_user.append(div_follow_button);

    // button_follow

  let  button_follow = document.createElement("button");
    button_follow.setAttribute("id", element.user_name);
    const user_f_data = follow_data.find(
  (e) => e.followee == unic_user_id && e.following == element.user_name
  );

    if (user_f_data == undefined) {
      button_follow.innerText = "follow";
    } else {
      button_follow.innerText = "Unfollow";
    }
  
    div_follow_button.append(button_follow);

    // follow function

    button_follow.addEventListener("click", function () {
      const following = this.id;
      const followee = unic_user_id;

      const follow_bn = document.getElementById(following);
      const follow_data = JSON.parse(localStorage.getItem("follow_data")) || [];
      if (follow_data.length === 0) {
        follow_data.push({
          following,
          followee,
          notification: false,
        });
        console.log(follow_data);
        follow_bn.innerHTML = "Unfollow";
        localStorage.setItem("follow_data", JSON.stringify(follow_data));
      } else {
        const user_f_data = follow_data.find(
          (e) => e.followee == unic_user_id && e.following == following
        );
        const indexOfuser_f = follow_data.indexOf(user_f_data);
        if (user_f_data == undefined) {
          follow_data.push({
            following,
            followee,
            notification: false,
          });
          follow_bn.innerText = "Unfollow";
          localStorage.setItem("follow_data", JSON.stringify(follow_data));
        } else {
          follow_data.splice(indexOfuser_f, 1);
          localStorage.setItem("follow_data", JSON.stringify(follow_data));
          follow_bn.innerText = "follow";
        }
      }
    });

  document.querySelector(".right_bottom").append(div_top_user);
}


//  follower following page
    let followers=document.getElementById("follower_count");
    let following=document.getElementById("following_count");

    function rederectingfollow(){
      location.href="../profile page/follower_following.html?user_id="+user_Id;
    }
    following.addEventListener("click",rederectingfollow);
    followers.addEventListener("click",rederectingfollow);


    </script>
  
    </body>

</html>